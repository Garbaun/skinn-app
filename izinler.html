<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Uygulama İzinleri</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; margin:0; padding:0; background:#e0e0e0; color:#333; min-height:100vh; display:flex; flex-direction:column; }
    header { display:flex; justify-content:space-between; align-items:center; padding:20px; background:#d0d0d0; box-shadow:0 2px 4px rgba(0,0,0,0.1); }
    header .kredi-button, .profil-button, .klinik-button { background:#c0c0c0; color:#333; border:3px solid #b0b0b0; border-radius:0; padding:10px 15px; font-weight:600; cursor:pointer; }
    header .cilt-ai-logo { margin: 0 auto; height:40px; display:flex; justify-content:center; font-size:35px; font-weight:bold; color:#555; cursor:pointer; }
    main { flex:1; display:flex; align-items:center; justify-content:center; padding:20px; }
    .container { width:100%; max-width:900px; margin:0 auto; padding:20px; background:#f0f0f0; border:3px solid #c0c0c0; border-radius:0; box-shadow:0 4px 8px rgba(0,0,0,0.1); }
    h1 { color:#2c3e50; margin-bottom:10px; text-align:center; }
    p.desc { text-align:center; color:#555; }
    .grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:15px; margin-top:20px; }
    .card { background:#e8e8e8; border:3px solid #b0b0b0; border-radius:0; padding:15px; }
    .card h3 { margin:0 0 8px; color:#2c3e50; }
    .card p { margin:0 0 10px; color:#444; }
    .neomorfik-button { padding:10px 20px; border:3px solid #2980b9; border-radius:0; font-size:16px; cursor:pointer; background:#3498db; color:#fff; box-shadow:2px 2px 5px rgba(0,0,0,0.2); font-weight:bold; }
    .status { margin-top:8px; font-size:14px; color:#555; }
    footer { background:#d0d0d0; color:#333; padding:10px; text-align:center; font-size:14px; margin-top:20px; border-top:3px solid #c0c0c0; }
    .help { font-size:13px; color:#666; margin-top:6px; }
  </style>
</head>
<body>
  <header>
    <div class="kredi-button" onclick="window.location.href='kredi-yukle.html'">100 Kredi Yüklü <span style="color:red;">Kredi Yükle</span></div>
    <div class="cilt-ai-logo" onclick="window.location.href='index.html'">cilt.ai beta v1.26</div>
    <div style="display:flex; gap:10px;">
      <div class="profil-button" onclick="window.location.href='profil-giris.html'">Profil Giriş</div>
      <div class="klinik-button" onclick="window.location.href='klinik-giris.html'">Klinik Giriş</div>
    </div>
  </header>
  <main>
    <div class="container">
      <h1>Uygulama İzinleri</h1>
      <p class="desc">Mobil cihazlarda bildirim ve kamera erişimi için gerekli izinleri buradan yönetebilirsiniz.</p>
      <div class="grid">
        <div class="card">
          <h3>Bildirim İzni</h3>
          <p>Tarayıcı bildirimleri için izin isteyin. Arka planda push bildirimi için servis çalışanı gerekir.</p>
          <button id="notif-btn" class="neomorfik-button">Bildirim izni iste</button>
          <div id="notif-status" class="status">Durum: bilinmiyor</div>
          <div class="help">Not: İzin verilmişse bildirimleri gösterebiliriz; push için servis çalışanı ve abonelik gerekir.</div>
        </div>
        <div class="card">
          <h3>Kamera İzni</h3>
          <p>Fotoğraf çekimi için kamera iznini isteyin. İzinden sonra akışı kapatılır.</p>
          <button id="cam-btn" class="neomorfik-button">Kamera izni iste</button>
          <div id="cam-status" class="status">Durum: bilinmiyor</div>
          <div class="help">Alternatif olarak fotoğraf yükleme alanında kamera açma: dosya seçiminde <code>capture</code> desteklenir.</div>
        </div>
        <div class="card">
          <h3>Galeri Erişimi</h3>
          <p>Web’de galeri erişimi dosya seçiciyle yapılır; OS düzeyinde ayrı bir izin yoktur.</p>
          <button id="gallery-btn" class="neomorfik-button">Galeriden fotoğraf seç</button>
          <input id="gallery-input" type="file" accept="image/*" capture="environment" style="display:none;" />
          <div id="gallery-status" class="status">Durum: bekleniyor</div>
        </div>
        <div class="card">
          <h3>PWA ve Servis Çalışanı</h3>
          <p>Arka plan push bildirimi ve offline özellikler için servis çalışanını kaydedin.</p>
          <button id="sw-btn" class="neomorfik-button">Servis çalışanını kaydet</button>
          <div id="sw-status" class="status">Durum: kayıtlı değil</div>
          <div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
            <button id="push-btn" class="neomorfik-button">Push aboneliği oluştur</button>
            <input id="vapid-input" type="text" placeholder="VAPID public key" style="flex:1; padding:8px; border:3px solid #b0b0b0;" />
            <input id="endpoint-input" type="text" placeholder="Backend subscribe endpoint" style="flex:1; padding:8px; border:3px solid #b0b0b0;" />
          </div>
          <div id="push-status" class="status">Durum: bekleniyor</div>
        </div>
      </div>
    </div>
  </main>
  <footer>
    cilt.ai <span class="kanduras-medya-link" onclick="window.open('http://www.kandurasmedya.com','_blank')">Kanduras Medya</span> oluşumudur. Tüm Hakları Saklıdır. Copyright 2025 ©
  </footer>
  <script src="push-config.js"></script>
  <script src="push-subscribe.js"></script>
  <script>
    const notifBtn = document.getElementById('notif-btn');
    const camBtn = document.getElementById('cam-btn');
    const galleryBtn = document.getElementById('gallery-btn');
    const galleryInput = document.getElementById('gallery-input');
    const swBtn = document.getElementById('sw-btn');
    const notifStatus = document.getElementById('notif-status');
    const camStatus = document.getElementById('cam-status');
    const galleryStatus = document.getElementById('gallery-status');
    const swStatus = document.getElementById('sw-status');

    function updateNotifStatus() {
      try {
        notifStatus.textContent = 'Durum: ' + (Notification.permission || 'bilinmiyor');
      } catch (e) {}
    }

    notifBtn.addEventListener('click', async () => {
      try {
        const res = await Notification.requestPermission();
        updateNotifStatus();
        if (res === 'granted') new Notification('Bildirim izni verildi');
      } catch (e) { notifStatus.textContent = 'Durum: hata'; }
    });

    camBtn.addEventListener('click', async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        camStatus.textContent = 'Durum: izin verildi';
        stream.getTracks().forEach(t => t.stop());
      } catch (e) {
        camStatus.textContent = 'Durum: reddedildi veya desteklenmiyor';
      }
    });

    galleryBtn.addEventListener('click', () => {
      galleryInput.click();
    });
    galleryInput.addEventListener('change', () => {
      if (galleryInput.files && galleryInput.files.length > 0) {
        galleryStatus.textContent = 'Durum: ' + galleryInput.files[0].name + ' seçildi';
      } else {
        galleryStatus.textContent = 'Durum: seçim yapılmadı';
      }
    });

    swBtn.addEventListener('click', async () => {
      if ('serviceWorker' in navigator) {
        try {
          const reg = await navigator.serviceWorker.register('service-worker.js');
          swStatus.textContent = 'Durum: kayıtlı (' + (reg.scope || '/') + ')';
        } catch (e) {
          swStatus.textContent = 'Durum: kayıt başarısız';
        }
      } else {
        swStatus.textContent = 'Durum: desteklenmiyor';
      }
    });

    const pushBtn=document.getElementById('push-btn');
    const pushStatus=document.getElementById('push-status');
    const vapidInput=document.getElementById('vapid-input');
    const endpointInput=document.getElementById('endpoint-input');
    pushBtn.addEventListener('click',async()=>{
      window.PushConfig.vapidPublicKey=vapidInput.value||window.PushConfig.vapidPublicKey||'';
      window.PushConfig.subscribeEndpoint=endpointInput.value||window.PushConfig.subscribeEndpoint||'';
      try{const sub=await window.PushSubscribe.subscribePush();pushStatus.textContent='Durum: abone olundu';localStorage.setItem('pushSubscription',JSON.stringify(sub));}catch(e){pushStatus.textContent='Durum: başarısız';}
    })

    updateNotifStatus();
  </script>
</body>
</html>