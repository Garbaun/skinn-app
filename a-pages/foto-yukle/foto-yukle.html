<!DOCTYPE html>
<html lang="tr"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Cilt.AI Fotoğraf Yükleme</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<link href="../../styles/site.css" rel="stylesheet"/>
<style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
  </style>
<script id="tailwind-config">
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          colors: {
            "primary": "#2badee",
            "background-light": "#f6f8f8",
            "background-dark": "#101f22",
            "text-primary": "#1A237E",
            "border-light": "#E0E0E0",
            "accent": "#FFDAB9",
          },
          fontFamily: {
            "display": ["Space Grotesk", "sans-serif"]
          },
          borderRadius: {
            "DEFAULT": "0.25rem",
            "lg": "0.5rem",
            "xl": "0.75rem",
            "full": "9999px"
          },
          height: {
            "11": "2.75rem",
            "12": "3rem",
            "13": "3.25rem",
            "14": "3.5rem",
            "15": "3.75rem",
            "16": "4rem",
            "screen-sm": "calc(100vh - 4rem)",
            "screen-md": "calc(100vh - 6rem)",
            "screen-lg": "calc(100vh - 8rem)"
          }
        },
      },
    }
  </script>
<style>
    body {
      min-height: 100vh;
      height: 100vh;
      overflow-y: auto;
    }
    /* Responsive height utilities */
    @media (max-height: 760px) {
      .h-responsive { height: clamp(36px, 8vh, 44px); }
      .text-responsive { font-size: 0.95rem; }
      .py-responsive { padding-top: 0.75rem; padding-bottom: 0.75rem; }
    }
    @media (max-height: 640px) {
      .h-responsive { height: clamp(32px, 7vh, 40px); }
      .text-responsive { font-size: 0.875rem; }
      .py-responsive { padding-top: 0.5rem; padding-bottom: 0.5rem; }
    }
    @media (max-height: 480px) {
      .h-responsive { height: clamp(28px, 6vh, 36px); }
      .text-responsive { font-size: 0.8rem; }
      .py-responsive { padding-top: 0.375rem; padding-bottom: 0.375rem; }
    }
  </style>
  </head>
<body class="font-display">
<div class="relative flex h-auto min-h-screen w-full flex-col bg-background-light dark:bg-background-dark group/design-root overflow-x-hidden text-text-primary">
<div class="site-header fixed top-0 left-0 right-0 z-20 px-5 pt-3 pb-3 bg-transparent">
  <button class="header-button" style="height: clamp(44px, 8vh, 56px); font-size: clamp(1rem, 2.5vh, 1.25rem);">
    <span class="title" style="font-size: clamp(1rem, 2.5vh, 1.25rem);">Fotoğraf Yükle</span>
    <span class="material-symbols-outlined" onclick="history.back()">arrow_back</span>
  </button>
</div>
<div class="flex-grow flex flex-col p-4 pt-[72px]">
<div id="upload-area" class="relative flex flex-col items-center justify-center w-full p-6 border-2 border-dashed border-border-light dark:border-gray-700 rounded-xl cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50 mb-6">
<span class="material-symbols-outlined text-4xl text-primary mb-2">upload_file</span>
<p class="text-lg font-bold text-text-primary dark:text-gray-200" style="font-size: clamp(1rem, 2.5vh, 1.125rem);">Fotoğraf seçmek için dokunun</p>
<p class="text-sm text-gray-500 dark:text-gray-400 mt-1">En fazla 3 fotoğraf yükleyebilirsiniz</p>
</div>
<input id="file-input" type="file" accept="image/*" multiple class="hidden"/>
<div class="mb-6">
<h3 class="text-text-primary dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] mb-4">Fotoğraf Bölgesi Seçimi</h3>
<div id="region-grid" class="grid grid-cols-3 gap-2">
<button class="flex w-full min-w-[84px] items-center justify-center overflow-hidden rounded-lg h-responsive px-3 bg-white dark:bg-gray-700 border border-border-light dark:border-gray-600 text-text-primary dark:text-white text-responsive font-bold leading-normal tracking-[0.015em]">Baş</button>
<button class="flex w-full min-w-[84px] items-center justify-center overflow-hidden rounded-lg h-responsive px-3 bg-white dark:bg-gray-700 border border-border-light dark:border-gray-600 text-text-primary dark:text-white text-responsive font-bold leading-normal tracking-[0.015em]">Boyun</button>
<button class="flex w-full min-w-[84px] items-center justify-center overflow-hidden rounded-lg h-responsive px-3 bg-white dark:bg-gray-700 border border-border-light dark:border-gray-600 text-text-primary dark:text-white text-responsive font-bold leading-normal tracking-[0.015em]">El ve Ayak</button>
<button class="flex w-full min-w-[84px] items-center justify-center overflow-hidden rounded-lg h-responsive px-3 bg-white dark:bg-gray-700 border border-border-light dark:border-gray-600 text-text-primary dark:text-white text-responsive font-bold leading-normal tracking-[0.015em]">Kol ve Bacak</button>
<button class="flex w-full min-w-[84px] items-center justify-center overflow-hidden rounded-lg h-responsive px-3 bg-white dark:bg-gray-700 border border-border-light dark:border-gray-600 text-text-primary dark:text-white text-responsive font-bold leading-normal tracking-[0.015em] touch-target">Vücut</button>
<button class="flex w-full min-w-[84px] items-center justify-center overflow-hidden rounded-lg h-responsive px-3 bg-white dark:bg-gray-700 border border-border-light dark:border-gray-600 text-text-primary dark:text-white text-responsive font-bold leading-normal tracking-[0.015em]">Genital</button>
</div>
</div>
<div class="mb-6 p-4 rounded-xl bg-accent/20 dark:bg-accent/10 border border-accent/50 dark:border-accent/30">
<h3 class="text-text-primary dark:text-white text-base font-bold leading-tight tracking-[-0.015em] mb-3 text-center">Çekim Yönergeleri</h3>
<div class="grid grid-cols-3 gap-2 text-center text-text-primary/80 dark:text-gray-300">
<div class="flex flex-col items-center gap-1.5">
<span class="material-symbols-outlined text-3xl text-primary">light_mode</span>
<p class="text-xs font-medium leading-tight">İyi ışık alan bir yerde çekin.</p>
</div>
<div class="flex flex-col items-center gap-1.5">
<span class="material-symbols-outlined text-3xl text-primary">center_focus_strong</span>
<p class="text-xs font-medium leading-tight">Net bir şekilde odaklayın.</p>
</div>
<div class="flex flex-col items-center gap-1.5">
<span class="material-symbols-outlined text-3xl text-primary">zoom_in</span>
<p class="text-xs font-medium leading-tight">Mümkün olduğunca yakın çekin.</p>
</div>
</div>
</div>
<div class="mt-4 p-3 rounded-lg bg-green-100/70 dark:bg-green-900/30 border border-green-200 dark:border-green-800/50 flex items-center gap-3 mb-6" id="status-box" style="display:none">
<span class="material-symbols-outlined text-green-600 dark:text-green-400">check_circle</span>
<p id="status-text" class="text-sm font-medium text-green-800 dark:text-green-300">0/3 fotoğraf yüklendi. Analize hazırsınız.</p>
</div>
<h3 class="text-text-primary dark:text-white text-lg font-bold leading-tight tracking-[-0.015em] px-0 pb-3 pt-2">Yüklenen Fotoğraflar (3/3)</h3>
<div class="grid grid-cols-3 gap-3" id="preview-grid">
<div class="flex flex-col gap-2">
<div id="preview1" class="relative w-full bg-center bg-no-repeat aspect-square bg-cover rounded-lg" data-alt="User's uploaded front view photo for skin analysis" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAdjDd1PD-1XBTIR8jB3FIS9ABDK1efXJQU8gIGOH_PPA8juPCbPWZd9U6Oo1TkOAanls4V4iF3uGzy3sUXWBomN0tKyORR6jGNOSvHiPZ_QFFJcohvA6SFZlJv-nt6g3P4uGRfQMPHDG-wHSJbHw6gQhzw0O4EGXAm9LgH5qre1Q8g5ZQwvpk0ZrUJXXCY3pnyBQE5Qj6lM5k3d2nXvuzE0I0LYwRkWoVoHKzfd1iFxWEyZCAoK-sMw_McUwYZAcrBkXrbW_rvWgM_");'>
<div class="absolute top-1.5 right-1.5 flex gap-1">
<button class="flex items-center justify-center size-6 rounded-full bg-black/60 text-white hover:bg-black/80">
<span class="material-symbols-outlined text-sm">crop_rotate</span>
</button>
<button class="flex items-center justify-center size-6 rounded-full bg-black/60 text-white hover:bg-black/80">
<span class="material-symbols-outlined text-sm">delete</span>
</button>
</div>
<div class="absolute bottom-1.5 left-1.5 right-1.5 px-1 py-0.5 bg-primary/80 rounded-full text-white text-[10px] font-bold text-center backdrop-blur-sm">Baş</div>
</div>
</div>
<div class="flex flex-col gap-2">
<div id="preview2" class="relative w-full bg-center bg-no-repeat aspect-square bg-cover rounded-lg" data-alt="User's second uploaded photo for skin analysis" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAdjDd1PD-1XBTIR8jB3FIS9ABDK1efXJQU8gIGOH_PPA8juPCbPWZd9U6Oo1TkOAanls4V4iF3uGzy3sUXWBomN0tKyORR6jGNOSvHiPZ_QFFJcohvA6SFZlJv-nt6g3P4uGRfQMPHDG-wHSJbHw6gQhzw0O4EGXAm9LgH5qre1Q8g5ZQwvpk0ZrUJXXCY3pnyBQE5Qj6lM5k3d2nXvuzE0I0LYwRkWoVoHKzfd1iFxWEyZCAoK-sMw_McUwYZAcrBkXrbW_rvWgM_"); transform: scaleX(-1);'>
<div class="absolute top-1.5 right-1.5 flex gap-1">
<button class="flex items-center justify-center size-6 rounded-full bg-black/60 text-white hover:bg-black/80">
<span class="material-symbols-outlined text-sm">crop_rotate</span>
</button>
<button class="flex items-center justify-center size-6 rounded-full bg-black/60 text-white hover:bg-black/80">
<span class="material-symbols-outlined text-sm">delete</span>
</button>
</div>
<div class="absolute bottom-1.5 left-1.5 right-1.5 px-1 py-0.5 bg-primary/80 rounded-full text-white text-[10px] font-bold text-center backdrop-blur-sm">Kol ve Bacak</div>
</div>
</div>
<div class="flex flex-col gap-2">
<div id="preview3" class="relative w-full bg-center bg-no-repeat aspect-square bg-cover rounded-lg" data-alt="User's third uploaded photo for skin analysis" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAdjDd1PD-1XBTIR8jB3FIS9ABDK1efXJQU8gIGOH_PPA8juPCbPWZd9U6Oo1TkOAanls4V4iF3uGzy3sUXWBomN0tKyORR6jGNOSvHiPZ_QFFJcohvA6SFZlJv-nt6g3P4uGRfQMPHDG-wHSJbHw6gQhzw0O4EGXAm9LgH5qre1Q8g5ZQwvpk0ZrUJXXCY3pnyBQE5Qj6lM5k3d2nXvuzE0I0LYwRkWoVoHKzfd1iFxWEyZCAoK-sMw_McUwYZAcrBkXrbW_rvWgM_"); filter: saturate(1.2);'>
<div class="absolute top-1.5 right-1.5 flex gap-1">
<button class="flex items-center justify-center size-6 rounded-full bg-black/60 text-white hover:bg-black/80">
<span class="material-symbols-outlined text-sm">crop_rotate</span>
</button>
<button class="flex items-center justify-center size-6 rounded-full bg-black/60 text-white hover:bg-black/80">
<span class="material-symbols-outlined text-sm">delete</span>
</button>
</div>
<div class="absolute bottom-1.5 left-1.5 right-1.5 px-1 py-0.5 bg-primary/80 rounded-full text-white text-[10px] font-bold text-center backdrop-blur-sm">Vücut</div>
</div>
</div>
</div>
</div>
<div class="sticky bottom-0 bg-white dark:bg-background-dark p-4 pt-2 mt-auto border-t border-border-light dark:border-gray-800">
<button id="start-btn" class="flex w-full min-w-[84px] items-center justify-center overflow-hidden rounded-lg h-responsive px-4 bg-primary text-white text-base font-bold leading-normal tracking-[0.015em]" disabled>
<span class="truncate">Analizi Başlat</span>
</button>
<p class="text-text-primary/60 dark:text-gray-500 text-xs text-center pt-3">
        Fotoğraflarınız gizli tutulur ve korunur. <a class="underline" href="#">Gizlilik Politikamızı</a> okuyun.
      </p>
</div>
<div id="region-modal" class="absolute inset-0 bg-black/60 z-20 flex items-center justify-center p-4 hidden">
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-sm text-center p-6 flex flex-col gap-4">
    <div class="flex flex-col gap-2">
      <h3 class="text-lg font-bold text-text-primary dark:text-white">Bölge Seçimi Gerekli</h3>
      <p class="text-sm text-text-primary/80 dark:text-gray-300">Lütfen yüklediğiniz fotoğrafların hangi vücut bölgesine ait olduğunu seçiniz.</p>
    </div>
    <button id="region-modal-close" class="w-full h-responsive px-4 mt-2 rounded-lg bg-primary text-white font-bold">Tamam</button>
  </div>
</div>
<div id="size-modal" class="absolute inset-0 bg-black/60 z-20 flex items-center justify-center p-4 hidden">
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-sm text-center p-6">
    <h3 class="text-lg font-bold text-text-primary dark:text-white mb-2">Dosya Boyutu Çok Büyük</h3>
    <p class="text-sm text-text-primary/80 dark:text-gray-300 mb-6">Lütfen 10MB'dan küçük bir dosya seçin.</p>
    <div class="flex flex-col gap-3">
      <button id="size-ok" class="w-full h-responsive px-4 rounded-lg bg-primary text-white font-bold">Anladım</button>
    </div>
  </div>
</div>
<div id="format-modal" class="absolute inset-0 bg-black/60 z-20 flex items-center justify-center p-4 hidden">
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-sm text-center p-6">
    <h3 class="text-lg font-bold text-text-primary dark:text-white mb-2">Geçersiz Dosya Formatı</h3>
    <p class="text-sm text-text-primary/80 dark:text-gray-300 mb-6">Lütfen sadece JPG veya PNG formatında resim seçin.</p>
    <button id="format-ok" class="w-full h-responsive px-4 rounded-lg bg-primary text-white font-bold">Tamam</button>
  </div>
</div>
<div id="progress-modal" class="absolute inset-0 bg-black/60 z-20 flex items-center justify-center p-4 hidden">
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-sm text-center p-6">
    <h3 class="text-lg font-bold text-text-primary dark:text-white mb-4">Yükleniyor...</h3>
    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mb-6">
      <div id="progress-bar" class="bg-primary h-2.5 rounded-full" style="width: 10%"></div>
    </div>
    <button id="progress-cancel" class="w-full h-responsive px-4 rounded-lg bg-gray-200 dark:bg-gray-600 text-text-primary dark:text-white font-bold">İptal</button>
  </div>
</div>
<div id="complete-modal" class="absolute inset-0 bg-black/60 z-20 flex items-center justify-center p-4 hidden">
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-sm text-center p-6">
    <span class="material-symbols-outlined text-5xl text-green-500 mb-3">check_circle</span>
    <h3 class="text-lg font-bold text-text-primary dark:text-white mb-2">Yükleme Tamamlandı</h3>
    <button id="complete-go" class="w-full h-responsive px-4 rounded-lg bg-primary text-white font-bold">Sonuçlara Git</button>
  </div>
</div>
<div id="no-photo-modal" class="absolute inset-0 bg-black/60 z-20 flex items-center justify-center p-4 hidden">
  <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg w-full max-w-sm text-center p-6">
    <span class="material-symbols-outlined text-5xl text-primary mb-3">image_search</span>
    <h3 class="text-lg font-bold text-text-primary dark:text-white mb-2">Fotoğraf Seçilmedi</h3>
    <p class="text-sm text-text-primary/80 dark:text-gray-300 mb-6">Lütfen analiz için en az bir fotoğraf seçin.</p>
    <button id="no-photo-ok" class="w-full h-responsive px-4 rounded-lg bg-primary text-white font-bold">Fotoğraf Seç</button>
  </div>
</div>
</div>

<script src="../../push-config.js"></script>
<script>
  const uploadArea=document.getElementById('upload-area');
  const fileInput=document.getElementById('file-input');
  const p1=document.getElementById('preview1');
  const p2=document.getElementById('preview2');
  const p3=document.getElementById('preview3');
  const startBtn=document.getElementById('start-btn');
  const statusBox=document.getElementById('status-box');
  const statusText=document.getElementById('status-text');
  const regionGrid=document.getElementById('region-grid');
  const regionModal=document.getElementById('region-modal');
  const regionModalClose=document.getElementById('region-modal-close');
  const sizeModal=document.getElementById('size-modal');
  const sizeOk=document.getElementById('size-ok');
  const formatModal=document.getElementById('format-modal');
  const formatOk=document.getElementById('format-ok');
  const progressModal=document.getElementById('progress-modal');
  const progressBar=document.getElementById('progress-bar');
  const progressCancel=document.getElementById('progress-cancel');
  const completeModal=document.getElementById('complete-modal');
  const completeGo=document.getElementById('complete-go');
  const noPhotoModal=document.getElementById('no-photo-modal');
  const noPhotoOk=document.getElementById('no-photo-ok');
  let dataUrls=[]; let filledCount=0;
  let regionSelected="";
  function setPreview(idx, url){
    const el=[p1,p2,p3][idx];
    if(el) el.style.backgroundImage=`url("${url}")`;
  }
  function updateStatus(){
    const cnt=Math.min(3,filledCount);
    if(statusBox) statusBox.style.display=cnt>0?'flex':'none';
    if(statusText) statusText.textContent=`${cnt}/3 fotoğraf yüklendi. Analize hazırsınız.`;
    if(startBtn){ startBtn.disabled = !(cnt>0 && !!regionSelected) }
  }
  function filesToDataUrls(files){
    const incoming=Array.from(files);
    const available=Math.max(0,3-filledCount);
    const list=incoming.slice(0,available);
    let done=0; const start=filledCount;
    list.forEach((file, k)=>{ if(!(file.type||'').startsWith('image/')){ if(formatModal) formatModal.classList.remove('hidden'); return } if(file.size>10485760){ if(sizeModal) sizeModal.classList.remove('hidden'); return } const r=new FileReader(); r.onload=e=>{ const idx=start+k; dataUrls[idx]=e.target.result; setPreview(idx, e.target.result); done++; if(done===list.length){ filledCount = Math.min(3, start + list.length); updateStatus() } }; r.readAsDataURL(file) })
    if(list.length===0) updateStatus();
  }
  if(uploadArea) uploadArea.addEventListener('click',()=>fileInput&&fileInput.click());
  if(fileInput) fileInput.addEventListener('change',e=>filesToDataUrls(e.target.files||[]));
  if(regionGrid){
    regionGrid.querySelectorAll('button').forEach(btn=>{
      btn.addEventListener('click',()=>{ regionSelected = (btn.textContent||'').trim(); localStorage.setItem('analysisRegion', regionSelected); updateStatus() })
    })
  }
  if(startBtn) startBtn.addEventListener('click', async ()=>{
    if(!dataUrls.length){ if(noPhotoModal) noPhotoModal.classList.remove('hidden'); return }
    if(!regionSelected){ if(regionModal) regionModal.classList.remove('hidden'); return }
    localStorage.setItem('uploadedImage', dataUrls[0]);
    try{
      if(progressModal) progressModal.classList.remove('hidden'); if(progressBar) progressBar.style.width='20%';
      const base=(window.PushConfig&&window.PushConfig.apiBase)?window.PushConfig.apiBase:'';
      const upRes=await fetch((base?base:'')+'/api/upload',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({dataUrl:dataUrls[0]})});
      if(progressBar) progressBar.style.width='60%';
      if(upRes.ok){ const upJson=await upRes.json(); const imageKey=upJson.imageKey;
        const anRes=await fetch((base?base:'')+'/api/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({imageKey})});
        if(progressBar) progressBar.style.width='90%';
        if(anRes.ok||anRes.status===202){ const anJson=await anRes.json(); if(anJson.jobId){ localStorage.setItem('jobId', anJson.jobId); try{ const arr=JSON.parse(localStorage.getItem('gecmisAnalizler')||'[]'); if(Array.isArray(arr)){ arr.push(anJson.jobId); localStorage.setItem('gecmisAnalizler', JSON.stringify(arr) ) } else { localStorage.setItem('gecmisAnalizler', JSON.stringify([anJson.jobId])) } }catch(_){ localStorage.setItem('gecmisAnalizler', JSON.stringify([anJson.jobId])) } } }
      }
    }catch(_){ }
    if(progressBar) progressBar.style.width='100%'; if(progressModal) progressModal.classList.add('hidden'); if(completeModal) completeModal.classList.remove('hidden');
  });
  if(uploadArea) uploadArea.addEventListener('dragover',e=>{ e.preventDefault() });
  if(uploadArea) uploadArea.addEventListener('drop',e=>{ e.preventDefault(); const fl=e.dataTransfer&&e.dataTransfer.files?e.dataTransfer.files:[]; filesToDataUrls(fl) });
  if(regionModalClose) regionModalClose.addEventListener('click',()=>{ if(regionModal) regionModal.classList.add('hidden') });
  if(sizeOk) sizeOk.addEventListener('click',()=>{ if(sizeModal) sizeModal.classList.add('hidden') });
  if(formatOk) formatOk.addEventListener('click',()=>{ if(formatModal) formatModal.classList.add('hidden') });
  if(progressCancel) progressCancel.addEventListener('click',()=>{ if(progressModal) progressModal.classList.add('hidden') });
  if(completeGo) completeGo.addEventListener('click',()=>{ window.location.href='../sonuclar/sonuclar.html' });
  if(noPhotoOk) noPhotoOk.addEventListener('click',()=>{ if(noPhotoModal) noPhotoModal.classList.add('hidden'); fileInput&&fileInput.click() });
</script>
</body></html>
